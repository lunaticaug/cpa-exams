# 개선된 Vision API 프롬프트

## 표 추출용 프롬프트 v2.0

```
이 이미지의 표를 추출해주세요. 다음 단계를 정확히 따라주세요:

### 1단계: 표 구조 분석
- 전체 행 개수: ___개
- 전체 열 개수: ___개  
- 병합된 셀 위치: ___
- 헤더 단계: ___단

### 2단계: 원시 데이터 추출
각 셀의 내용을 정확한 위치와 함께 나열:
```
[0,0]: "사용부문"
[0,1]: "보조부문" (2열 병합)
[0,3]: "제조부문" (3열 병합)
[1,0]: "제공부문"
[1,1]: "수선"
[1,2]: "식당"
...
[2,0]: "수선(단위:시간)"
[2,1]: "400"
[2,2]: "160"
...
```

### 3단계: 데이터 검증
□ 각 데이터 행의 셀 개수가 열 개수와 일치하는가?
□ 빈 셀을 건너뛰지 않았는가?
□ 단위 표시("단위:시간")가 별도 행으로 분리되지 않았는가?
□ 숫자들이 올바른 위치에 있는가?

### 4단계: 구조화된 출력
위 분석을 바탕으로 정리된 표를 마크다운으로 작성

### 주의사항
- "(단위:시간)"은 행 제목의 일부이지 별도 행이 아님
- 첫 번째 데이터 셀이 비어있을 수 있음 - 이를 데이터 없음으로 오해하지 말 것
- 상호배분표의 경우 보조부문이 자기 자신에게도 서비스를 제공할 수 있음
```

## 실전 적용 예시

### AS-IS (오류 발생)
```python
# 단순 지시
"표를 마크다운으로 변환해주세요"
```

### TO-BE (정확한 추출)
```python
prompt = """
이미지의 [연간 예산 용역의 양] 표를 추출합니다.

예상 구조:
- 2x2 헤더 (사용부문/제공부문)
- 2개 데이터 행 (수선부문, 식당부문)
- 5개 데이터 열 (수선, 식당, X, Y, Z)

주의: 
- "수선(단위:시간)"은 하나의 행 레이블
- 첫 번째 숫자부터 빠뜨리지 말고 추출
- 예: 수선부문 → [400, 160, 160, 480, 800]

추출 후 검증:
- 수선부문 합계: 2,000시간
- 식당부문 합계: 600명
"""
```

## 오류 패턴 데이터베이스

### 패턴 1: 단위 분리 오류
- 증상: "(단위:시간)"이 별도 행으로
- 원인: 시각적 정렬 착각
- 해결: 명시적으로 "행 레이블의 일부" 언급

### 패턴 2: 첫 열 데이터 누락
- 증상: 보조부문 간 서비스 데이터 누락
- 원인: "자기 참조는 없을 것"이라는 선입견
- 해결: "상호배분" 개념 설명 포함

### 패턴 3: 병합 셀 처리 오류
- 증상: 데이터가 잘못된 열에 배치
- 원인: 병합된 헤더 구조 파악 실패
- 해결: 셀 좌표 기반 추출

이러한 체계적 접근으로 표 추출 정확도를 95% 이상으로 향상시킬 수 있습니다!